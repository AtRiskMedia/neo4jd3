{"version":3,"file":"neo4jd3.js","names":["d3","Neo4jD3","selector","_options","container","graph","info","classes2colors","numClasses","node","nodes","relationship","relationships","simulation","svg","options","colors","neo4jData","undefined","neo4jDataUrl","distance","strength","labelFontSize","infoPanel","VERSION","init","version","color","length","Math","random","defaultColor","defaultDarkenColor","rgb","darker","defaultEdgeColor","merge","target","source","Object","keys","forEach","property","toString","d","s","labels","type","id","properties","JSON","stringify","contains","array","filter","elem","linkArc","r","hypot","x","y","linknum","drag","dragstarted","event","active","alphaTarget","restart","fx","fy","dragged","dragended","on","appendInfoPanel","append","attr","appendInfoElement","cls","isNode","value","html","style","class2color","class2darkenColor","appendInfoElementClass","appendInfoElementProperty","appendInfoElementRelationship","clearInfo","updateInfo","_types","Array","from","Set","map","_relationships","i","size","neo4jDataToD3Data","data","results","result","push","startNode","endNode","sort","a","b","hasOwnProperty","select","types","forceSimulation","force","forceManyBody","forceLink","forceCenter","parentElement","clientWidth","clientHeight","svgRelationships","selectAll","join","relationshipArc","relationshipLabel","text","allNodes","e","call"],"sources":["../src/scripts/neo4jd3.js"],"sourcesContent":["/* global d3, document */\n/* jshint latedef:nofunc */\n\"use strict\";\n\nimport * as d3 from \"d3\";\n\nexport default function Neo4jD3(selector, _options) {\n  var container,\n    graph,\n    info,\n    classes2colors = {},\n    numClasses = 0,\n    node,\n    nodes,\n    relationship,\n    relationships,\n    selector,\n    simulation,\n    svg,\n    options = {\n      colors: colors(),\n      neo4jData: undefined,\n      neo4jDataUrl: undefined,\n      distance: 100,\n      strength: -300,\n      labelFontSize: \"12px\",\n      infoPanel: false,\n    },\n    VERSION = \"0.1.0\";\n\n  init(selector, _options);\n\n  function version() {\n    return VERSION;\n  }\n\n  function colors() {\n    // oneDark inspired by distrotube (dt)\n    return [\n      \"#1c1f24\", // black\n      \"#ff6c6b\", // red\n      \"#98be65\", // green\n      \"#da8548\", // yellow\n      \"#51afef\", // blue\n      \"#c678dd\", // magenta\n      \"#5699af\", // cyan\n      \"#a7b1b7\", // white\n      \"#5b6268\", // brighter black\n      \"#da8548\", // brighter red\n      \"#4db5bd\", // brighter green\n      \"#ecbe7b\", // brighter yellow\n      \"#3071db\", // brighter blue\n      \"#a9a1e1\", // brighter magenta\n      \"#46d9ff\", // brighter cyan\n      \"#dfdfdf\", // brighter white\n    ];\n  }\n\n  function color() {\n    return options.colors[(options.colors.length * Math.random()) << 0];\n  }\n  function defaultColor() {\n    return options.colors[4];\n  }\n  function defaultDarkenColor() {\n    return d3.rgb(options.colors[options.colors.length - 1]).darker(1);\n  }\n  function defaultEdgeColor() {\n    return options.colors[0];\n  }\n\n  function merge(target, source) {\n    Object.keys(source).forEach(function (property) {\n      target[property] = source[property];\n    });\n  }\n\n  function toString(d) {\n    var s = d.labels ? d.labels[0] : d.type;\n\n    s += \" (<id>: \" + d.id;\n\n    Object.keys(d.properties).forEach(function (property) {\n      s += \", \" + property + \": \" + JSON.stringify(d.properties[property]);\n    });\n\n    s += \")\";\n\n    return s;\n  }\n\n  function contains(array, id) {\n    var filter = array.filter(function (elem) {\n      return elem.id === id;\n    });\n    return filter.length > 0;\n  }\n\n  function linkArc(d) {\n    const r =\n      Math.hypot(d.target.x - d.source.x, d.target.y - d.source.y) / d.linknum;\n    return `\n    M${d.source.x},${d.source.y}\n    A${r},${r} 0 0,1 ${d.target.x},${d.target.y}\n  `;\n  }\n\n  function drag(simulation) {\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    return d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n  }\n\n  function appendInfoPanel(container) {\n    return container.append(\"div\").attr(\"class\", \"neo4jd3-info\");\n  }\n\n  function appendInfoElement(cls, isNode, property, value) {\n    var elem = info.append(\"div\");\n    elem\n      .attr(\"class\", cls)\n      .html(\"<strong>\" + property + \"</strong>\" + (value ? \": \" + value : \"\"));\n    if (!value) {\n      elem\n        .style(\"color\", function (d) {\n          return property ? class2color(property) : defaultColor();\n        })\n        .style(\"border-color\", function (d) {\n          return property ? class2darkenColor(property) : defaultDarkenColor();\n        });\n    }\n  }\n\n  function appendInfoElementClass(cls, node) {\n    appendInfoElement(cls, true, node);\n  }\n\n  function appendInfoElementProperty(cls, property, value) {\n    appendInfoElement(cls, false, property, value);\n  }\n\n  function appendInfoElementRelationship(cls, relationship) {\n    appendInfoElement(cls, false, relationship);\n  }\n\n  function class2color(cls) {\n    var color = classes2colors[cls];\n    if (!color) {\n      //            color = options.colors[Math.min(numClasses, options.colors.length - 1)];\n      color = options.colors[numClasses % options.colors.length];\n      classes2colors[cls] = color;\n      numClasses++;\n    }\n    return color;\n  }\n\n  function class2darkenColor(cls) {\n    return d3.rgb(class2color(cls)).darker(1);\n  }\n\n  function clearInfo() {\n    info.html(\"\");\n  }\n\n  function updateInfo(d) {\n    clearInfo();\n\n    if (d.labels) {\n      appendInfoElementClass(\"class\", d.labels[0]);\n    } else {\n      appendInfoElementRelationship(\"class\", d.type);\n    }\n\n    appendInfoElementProperty(\"property\", \"id\", d.id);\n\n    Object.keys(d.properties).forEach(function (property) {\n      appendInfoElementProperty(\n        \"property\",\n        property,\n        JSON.stringify(d.properties[property])\n      );\n    });\n  }\n\n  function _types(relationships) {\n    return Array.from(new Set(relationships.map((d) => d.type)));\n  }\n\n  function _relationships(relationships) {\n    for (var i = 0; i < relationships.length; i++) {\n      if (\n        i != 0 &&\n        relationships[i].source == relationships[i - 1].source &&\n        relationships[i].target == relationships[i - 1].target\n      ) {\n        relationships[i].linknum = relationships[i - 1].linknum + 1;\n      } else {\n        relationships[i].linknum = 1;\n      }\n    }\n    return relationships;\n  }\n\n  function size() {\n    return {\n      nodes: nodes.length,\n      relationships: relationships.length,\n    };\n  }\n\n  function neo4jDataToD3Data(data) {\n    var graph = {\n      nodes: [],\n      relationships: [],\n    };\n    data.results.forEach(function (result) {\n      result.data.forEach(function (data) {\n        data.graph.nodes.forEach(function (node) {\n          if (!contains(graph.nodes, node.id)) {\n            graph.nodes.push(node);\n          }\n        });\n        data.graph.relationships.forEach(function (relationship) {\n          relationship.source = relationship.startNode;\n          relationship.target = relationship.endNode;\n          graph.relationships.push(relationship);\n        });\n        data.graph.relationships.sort(function (a, b) {\n          if (a.source > b.source) {\n            return 1;\n          } else if (a.source < b.source) {\n            return -1;\n          } else {\n            if (a.target > b.target) {\n              return 1;\n            }\n            if (a.target < b.target) {\n              return -1;\n            } else {\n              return 0;\n            }\n          }\n        });\n        for (var i = 0; i < data.graph.relationships.length; i++) {\n          if (\n            i !== 0 &&\n            data.graph.relationships[i].source ===\n              data.graph.relationships[i - 1].source &&\n            data.graph.relationships[i].target ===\n              data.graph.relationships[i - 1].target\n          ) {\n            data.graph.relationships[i].linknum =\n              data.graph.relationships[i - 1].linknum + 1;\n          } else {\n            data.graph.relationships[i].linknum = 1;\n          }\n        }\n      });\n    });\n    return graph;\n  }\n\n  function init(selector, _options) {\n    merge(options, _options);\n    if (options.hasOwnProperty(\"neo4jData\")) {\n      const data = neo4jDataToD3Data(options.neo4jData);\n      const container = d3.select(selector);\n      container.attr(\"class\", \"neo4jd3\").html(\"\");\n      if (options?.infoPanel) {\n        info = appendInfoPanel(container);\n      }\n      const relationships = _relationships(data.relationships);\n      const nodes = data.nodes;\n      const types = _types(relationships);\n      const svg = container\n        .append(\"svg\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .attr(\"class\", \"neo4jd3-graph\");\n      const simulation = d3\n        .forceSimulation(nodes)\n        .force(\"charge\", d3.forceManyBody().strength(options.strength))\n        .force(\n          \"link\",\n          d3\n            .forceLink(relationships)\n            .id(function (d) {\n              return d.id;\n            })\n            .distance(function (d) {\n              return options.distance;\n            })\n        )\n        .force(\n          \"center\",\n          d3.forceCenter(\n            svg.node().parentElement.parentElement.clientWidth / 2,\n            svg.node().parentElement.parentElement.clientHeight / 2\n          )\n        );\n      const svgRelationships = svg\n        .append(\"g\")\n        .attr(\"class\", \"relationships\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke-width\", 4)\n        .selectAll(\"g\")\n        .data(relationships, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"relationship\");\n      const relationshipArc = svg\n        .selectAll(\".relationship\")\n        .append(\"path\")\n        .attr(\"id\", function (d, i) {\n          return \"edgepath\" + i;\n        })\n        .join(\"path\")\n        .attr(\"stroke\", (d) => class2color(d.type));\n      const relationshipLabel = svg\n        .selectAll(\".relationship\")\n        .append(\"text\")\n        .attr(\"class\", \"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"font-size\", options.labelFontSize)\n        .attr(\"class\", \"text\")\n        .append(\"textPath\")\n        .attr(\"xlink:xlink:href\", function (d, i) {\n          return \"#edgepath\" + i;\n        })\n        .text(function (d) {\n          return `___${d.type}`;\n        });\n      const allNodes = svg\n        .append(\"g\")\n        .attr(\"class\", \"nodes\")\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"class\", \"node\")\n        .attr(\"stroke-linecap\", \"round\")\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"cursor\", \"pointer\")\n        .selectAll(\"g\")\n        .data(nodes, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"node\")\n        .on(\"mouseover\", function (e, d) {\n          if (info) updateInfo(d);\n        })\n        .on(\"mouseleave\", function (e, d) {\n          if (info) clearInfo(d);\n        })\n        .call(drag(simulation));\n      allNodes\n        .append(\"circle\")\n        .attr(\"stroke\", \"#000\")\n        .attr(\"stroke-width\", 2)\n        .attr(\"fill\", (d) => class2color(d.labels[0]))\n        .attr(\"r\", 17)\n        .append(\"title\")\n        .text(function (d) {\n          return toString(d);\n        });\n      simulation.on(\"tick\", function () {\n        relationshipArc.attr(\"d\", linkArc);\n        allNodes.attr(\"transform\", (d) => `translate(${d.x},${d.y})`);\n      });\n    }\n  }\n\n  return {\n    neo4jDataToD3Data: neo4jDataToD3Data,\n    size: size,\n    version: version,\n  };\n}\n"],"mappings":"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"}