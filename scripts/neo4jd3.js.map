{"version":3,"file":"neo4jd3.js","names":["d3","Neo4jD3","selector","_options","info","classes2colors","numClasses","nodes","relationships","options","colors","neo4jData","undefined","neo4jDataUrl","distance","strength","labelFontSize","infoPanel","VERSION","init","version","color","length","Math","random","defaultColor","defaultDarkenColor","rgb","darker","defaultEdgeColor","merge","target","source","Object","keys","forEach","property","toString","d","s","labels","type","id","properties","JSON","stringify","contains","array","filter","elem","linkArc","r","hypot","x","y","linknum","drag","simulation","dragstarted","event","active","alphaTarget","restart","fx","fy","dragged","dragended","on","appendInfoPanel","container","append","attr","appendInfoElement","cls","value","html","style","class2color","class2darkenColor","appendInfoElementClass","node","appendInfoElementProperty","appendInfoElementRelationship","relationship","clearInfo","updateInfo","_types","Array","from","Set","map","_relationships","i","size","neo4jDataToD3Data","data","graph","results","result","push","startNode","endNode","sort","a","b","hasOwnProperty","select","svg","forceSimulation","force","forceManyBody","forceLink","forceCenter","parentElement","clientWidth","clientHeight","selectAll","join","relationshipArc","text","allNodes","e","call"],"sources":["../src/scripts/neo4jd3.js"],"sourcesContent":["/* global d3, document */\n/* jshint latedef:nofunc */\n\"use strict\";\n\nimport * as d3 from \"d3\";\n\nexport default function Neo4jD3(selector, _options) {\n  var info,\n    classes2colors = {},\n    numClasses = 0,\n    nodes,\n    relationships,\n    selector,\n    options = {\n      colors: colors(),\n      neo4jData: undefined,\n      neo4jDataUrl: undefined,\n      distance: 100,\n      strength: -300,\n      labelFontSize: \"12px\",\n      infoPanel: false,\n    },\n    VERSION = \"0.1.0\";\n\n  init(selector, _options);\n\n  function version() {\n    return VERSION;\n  }\n\n  function colors() {\n    // oneDark inspired by distrotube (dt)\n    return [\n      \"#1c1f24\", // black\n      \"#ff6c6b\", // red\n      \"#98be65\", // green\n      \"#da8548\", // yellow\n      \"#51afef\", // blue\n      \"#c678dd\", // magenta\n      \"#5699af\", // cyan\n      \"#a7b1b7\", // white\n      \"#5b6268\", // brighter black\n      \"#da8548\", // brighter red\n      \"#4db5bd\", // brighter green\n      \"#ecbe7b\", // brighter yellow\n      \"#3071db\", // brighter blue\n      \"#a9a1e1\", // brighter magenta\n      \"#46d9ff\", // brighter cyan\n      \"#dfdfdf\", // brighter white\n    ];\n  }\n\n  function color() {\n    return options.colors[(options.colors.length * Math.random()) << 0];\n  }\n  function defaultColor() {\n    return options.colors[4];\n  }\n  function defaultDarkenColor() {\n    return d3.rgb(options.colors[options.colors.length - 1]).darker(1);\n  }\n  function defaultEdgeColor() {\n    return options.colors[0];\n  }\n\n  function merge(target, source) {\n    Object.keys(source).forEach(function (property) {\n      target[property] = source[property];\n    });\n  }\n\n  function toString(d) {\n    var s = d.labels ? d.labels[0] : d.type;\n\n    s += \" (<id>: \" + d.id;\n\n    Object.keys(d.properties).forEach(function (property) {\n      s += \", \" + property + \": \" + JSON.stringify(d.properties[property]);\n    });\n\n    s += \")\";\n\n    return s;\n  }\n\n  function contains(array, id) {\n    var filter = array.filter(function (elem) {\n      return elem.id === id;\n    });\n    return filter.length > 0;\n  }\n\n  function linkArc(d) {\n    const r =\n      Math.hypot(d.target.x - d.source.x, d.target.y - d.source.y) / d.linknum;\n    return `\n    M${d.source.x},${d.source.y}\n    A${r},${r} 0 0,1 ${d.target.x},${d.target.y}\n  `;\n  }\n\n  function drag(simulation) {\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    return d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n  }\n\n  function appendInfoPanel(container) {\n    return container.append(\"div\").attr(\"class\", \"neo4jd3-info\");\n  }\n\n  function appendInfoElement(cls, property, value) {\n    var elem = info.append(\"div\");\n    elem\n      .attr(\"class\", cls)\n      .html(\"<strong>\" + property + \"</strong>\" + (value ? \": \" + value : \"\"));\n    if (!value) {\n      elem\n        .style(\"color\", function () {\n          return property ? class2color(property) : defaultColor();\n        })\n        .style(\"border-color\", function () {\n          return property ? class2darkenColor(property) : defaultDarkenColor();\n        });\n    }\n  }\n\n  function appendInfoElementClass(cls, node) {\n    appendInfoElement(cls, true, node);\n  }\n\n  function appendInfoElementProperty(cls, property, value) {\n    appendInfoElement(cls, false, property, value);\n  }\n\n  function appendInfoElementRelationship(cls, relationship) {\n    appendInfoElement(cls, false, relationship);\n  }\n\n  function class2color(cls) {\n    var color = classes2colors[cls];\n    if (!color) {\n      //            color = options.colors[Math.min(numClasses, options.colors.length - 1)];\n      color = options.colors[numClasses % options.colors.length];\n      classes2colors[cls] = color;\n      numClasses++;\n    }\n    return color;\n  }\n\n  function class2darkenColor(cls) {\n    return d3.rgb(class2color(cls)).darker(1);\n  }\n\n  function clearInfo() {\n    info.html(\"\");\n  }\n\n  function updateInfo(d) {\n    clearInfo();\n\n    if (d.labels) {\n      appendInfoElementClass(\"class\", d.labels[0]);\n    } else {\n      appendInfoElementRelationship(\"class\", d.type);\n    }\n\n    appendInfoElementProperty(\"property\", \"id\", d.id);\n\n    Object.keys(d.properties).forEach(function (property) {\n      appendInfoElementProperty(\n        \"property\",\n        property,\n        JSON.stringify(d.properties[property])\n      );\n    });\n  }\n\n  function _types(relationships) {\n    return Array.from(new Set(relationships.map((d) => d.type)));\n  }\n\n  function _relationships(relationships) {\n    for (var i = 0; i < relationships.length; i++) {\n      if (\n        i != 0 &&\n        relationships[i].source == relationships[i - 1].source &&\n        relationships[i].target == relationships[i - 1].target\n      ) {\n        relationships[i].linknum = relationships[i - 1].linknum + 1;\n      } else {\n        relationships[i].linknum = 1;\n      }\n    }\n    return relationships;\n  }\n\n  function size() {\n    return {\n      nodes: nodes.length,\n      relationships: relationships.length,\n    };\n  }\n\n  function neo4jDataToD3Data(data) {\n    var graph = {\n      nodes: [],\n      relationships: [],\n    };\n    data?.results?.forEach(function (result) {\n      result.data.forEach(function (data) {\n        data.graph.nodes.forEach(function (node) {\n          if (!contains(graph.nodes, node.id)) {\n            graph.nodes.push(node);\n          }\n        });\n        data.graph.relationships.forEach(function (relationship) {\n          relationship.source = relationship.startNode;\n          relationship.target = relationship.endNode;\n          graph.relationships.push(relationship);\n        });\n        data.graph.relationships.sort(function (a, b) {\n          if (a.source > b.source) {\n            return 1;\n          } else if (a.source < b.source) {\n            return -1;\n          } else {\n            if (a.target > b.target) {\n              return 1;\n            }\n            if (a.target < b.target) {\n              return -1;\n            } else {\n              return 0;\n            }\n          }\n        });\n        for (var i = 0; i < data.graph.relationships.length; i++) {\n          if (\n            i !== 0 &&\n            data.graph.relationships[i].source ===\n              data.graph.relationships[i - 1].source &&\n            data.graph.relationships[i].target ===\n              data.graph.relationships[i - 1].target\n          ) {\n            data.graph.relationships[i].linknum =\n              data.graph.relationships[i - 1].linknum + 1;\n          } else {\n            data.graph.relationships[i].linknum = 1;\n          }\n        }\n      });\n    });\n    return graph;\n  }\n\n  function init(selector, _options) {\n    merge(options, _options);\n    if (options.hasOwnProperty(\"neo4jData\")) {\n      const data = neo4jDataToD3Data(options.neo4jData);\n      const container = d3.select(selector);\n      container.attr(\"class\", \"neo4jd3\").html(\"\");\n      if (options?.infoPanel) {\n        info = appendInfoPanel(container);\n      }\n      const relationships = _relationships(data.relationships);\n      const nodes = data.nodes;\n      const svg = container\n        .append(\"svg\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .attr(\"class\", \"neo4jd3-graph\");\n      const simulation = d3\n        .forceSimulation(nodes)\n        .force(\"charge\", d3.forceManyBody().strength(options.strength))\n        .force(\n          \"link\",\n          d3\n            .forceLink(relationships)\n            .id(function (d) {\n              return d?.id;\n            })\n            .distance(function () {\n              return options?.distance | 150;\n            })\n        )\n        .force(\n          \"center\",\n          d3.forceCenter(\n            svg.node().parentElement.parentElement.clientWidth / 2,\n            svg.node().parentElement.parentElement.clientHeight / 2\n          )\n        );\n      svg\n        .append(\"g\")\n        .attr(\"class\", \"relationships\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke-width\", 4)\n        .selectAll(\"g\")\n        .data(relationships, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"relationship\");\n      const relationshipArc = svg\n        .selectAll(\".relationship\")\n        .append(\"path\")\n        .attr(\"id\", function (d, i) {\n          return \"edgepath\" + i;\n        })\n        .join(\"path\")\n        .attr(\"stroke\", (d) => class2color(d.type));\n      svg\n        .selectAll(\".relationship\")\n        .append(\"text\")\n        .attr(\"class\", \"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"font-size\", options.labelFontSize)\n        .attr(\"class\", \"text\")\n        .append(\"textPath\")\n        .attr(\"xlink:xlink:href\", function (d, i) {\n          return \"#edgepath\" + i;\n        })\n        .text(function (d) {\n          return `___${d.type}`;\n        });\n      const allNodes = svg\n        .append(\"g\")\n        .attr(\"class\", \"nodes\")\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"class\", \"node\")\n        .attr(\"stroke-linecap\", \"round\")\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"cursor\", \"pointer\")\n        .selectAll(\"g\")\n        .data(nodes, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"node\")\n        .on(\"mouseover\", function (e, d) {\n          if (info) updateInfo(d);\n        })\n        .on(\"mouseleave\", function (e, d) {\n          if (info) clearInfo(d);\n        })\n        .call(drag(simulation));\n      allNodes\n        .append(\"circle\")\n        .attr(\"stroke\", \"#000\")\n        .attr(\"stroke-width\", 2)\n        .attr(\"fill\", (d) => class2color(d.labels[0]))\n        .attr(\"r\", 17)\n        .append(\"title\")\n        .text(function (d) {\n          return toString(d);\n        });\n      simulation.on(\"tick\", function () {\n        relationshipArc.attr(\"d\", linkArc);\n        allNodes.attr(\"transform\", (d) => `translate(${d.x},${d.y})`);\n      });\n    }\n  }\n\n  return {\n    neo4jDataToD3Data: neo4jDataToD3Data,\n    size: size,\n    version: version,\n  };\n}\n"],"mappings":"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"}