{"version":3,"file":"neo4jd3.js","names":["d3","Neo4jD3","selector","_options","container","graph","info","classes2colors","numClasses","node","nodes","relationship","relationships","simulation","svg","options","colors","neo4jData","undefined","neo4jDataUrl","distance","strength","labelFontSize","infoPanel","VERSION","init","version","color","length","Math","random","defaultColor","defaultDarkenColor","rgb","darker","defaultEdgeColor","merge","target","source","Object","keys","forEach","property","toString","d","s","labels","type","id","properties","JSON","stringify","contains","array","filter","elem","linkArc","r","hypot","x","y","linknum","drag","dragstarted","event","active","alphaTarget","restart","fx","fy","dragged","dragended","on","appendInfoPanel","append","attr","appendInfoElement","cls","isNode","value","html","style","class2color","class2darkenColor","appendInfoElementClass","appendInfoElementProperty","appendInfoElementRelationship","clearInfo","updateInfo","_types","Array","from","Set","map","_relationships","i","size","neo4jDataToD3Data","data","results","result","push","startNode","endNode","sort","a","b","hasOwnProperty","select","types","forceSimulation","force","forceManyBody","forceLink","forceCenter","parentElement","clientWidth","clientHeight","svgRelationships","selectAll","join","relationshipArc","relationshipLabel","text","allNodes","e","call"],"sources":["../src/scripts/neo4jd3.js"],"sourcesContent":["/* global d3, document */\n/* jshint latedef:nofunc */\n\"use strict\";\n\nimport * as d3 from \"d3\";\n\nexport default function Neo4jD3(selector, _options) {\n  var container,\n    graph,\n    info,\n    classes2colors = {},\n    numClasses = 0,\n    node,\n    nodes,\n    relationship,\n    relationships,\n    selector,\n    simulation,\n    svg,\n    options = {\n      colors: colors(),\n      neo4jData: undefined,\n      neo4jDataUrl: undefined,\n      distance: 100,\n      strength: -300,\n      labelFontSize: \"12px\",\n      infoPanel: false,\n    },\n    VERSION = \"0.1.0\";\n\n  init(selector, _options);\n\n  function version() {\n    return VERSION;\n  }\n\n  function colors() {\n    // oneDark inspired by distrotube (dt)\n    return [\n      \"#1c1f24\", // black\n      \"#ff6c6b\", // red\n      \"#98be65\", // green\n      \"#da8548\", // yellow\n      \"#51afef\", // blue\n      \"#c678dd\", // magenta\n      \"#5699af\", // cyan\n      \"#a7b1b7\", // white\n      \"#5b6268\", // brighter black\n      \"#da8548\", // brighter red\n      \"#4db5bd\", // brighter green\n      \"#ecbe7b\", // brighter yellow\n      \"#3071db\", // brighter blue\n      \"#a9a1e1\", // brighter magenta\n      \"#46d9ff\", // brighter cyan\n      \"#dfdfdf\", // brighter white\n    ];\n  }\n\n  function color() {\n    return options.colors[(options.colors.length * Math.random()) << 0];\n  }\n  function defaultColor() {\n    return options.colors[4];\n  }\n  function defaultDarkenColor() {\n    return d3.rgb(options.colors[options.colors.length - 1]).darker(1);\n  }\n  function defaultEdgeColor() {\n    return options.colors[0];\n  }\n\n  function merge(target, source) {\n    Object.keys(source).forEach(function (property) {\n      target[property] = source[property];\n    });\n  }\n\n  function toString(d) {\n    var s = d.labels ? d.labels[0] : d.type;\n\n    s += \" (<id>: \" + d.id;\n\n    Object.keys(d.properties).forEach(function (property) {\n      s += \", \" + property + \": \" + JSON.stringify(d.properties[property]);\n    });\n\n    s += \")\";\n\n    return s;\n  }\n\n  function contains(array, id) {\n    var filter = array.filter(function (elem) {\n      return elem.id === id;\n    });\n    return filter.length > 0;\n  }\n\n  function linkArc(d) {\n    const r =\n      Math.hypot(d.target.x - d.source.x, d.target.y - d.source.y) / d.linknum;\n    return `\n    M${d.source.x},${d.source.y}\n    A${r},${r} 0 0,1 ${d.target.x},${d.target.y}\n  `;\n  }\n\n  function drag(simulation) {\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    return d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n  }\n\n  function appendInfoPanel(container) {\n    return container.append(\"div\").attr(\"class\", \"neo4jd3-info\");\n  }\n\n  function appendInfoElement(cls, isNode, property, value) {\n    var elem = info.append(\"div\");\n    elem\n      .attr(\"class\", cls)\n      .html(\"<strong>\" + property + \"</strong>\" + (value ? \": \" + value : \"\"));\n    if (!value) {\n      elem\n        .style(\"color\", function (d) {\n          return property ? class2color(property) : defaultColor();\n        })\n        .style(\"border-color\", function (d) {\n          return property ? class2darkenColor(property) : defaultDarkenColor();\n        });\n    }\n  }\n\n  function appendInfoElementClass(cls, node) {\n    appendInfoElement(cls, true, node);\n  }\n\n  function appendInfoElementProperty(cls, property, value) {\n    appendInfoElement(cls, false, property, value);\n  }\n\n  function appendInfoElementRelationship(cls, relationship) {\n    appendInfoElement(cls, false, relationship);\n  }\n\n  function class2color(cls) {\n    var color = classes2colors[cls];\n    if (!color) {\n      //            color = options.colors[Math.min(numClasses, options.colors.length - 1)];\n      color = options.colors[numClasses % options.colors.length];\n      classes2colors[cls] = color;\n      numClasses++;\n    }\n    return color;\n  }\n\n  function class2darkenColor(cls) {\n    return d3.rgb(class2color(cls)).darker(1);\n  }\n\n  function clearInfo() {\n    info.html(\"\");\n  }\n\n  function updateInfo(d) {\n    clearInfo();\n\n    if (d.labels) {\n      appendInfoElementClass(\"class\", d.labels[0]);\n    } else {\n      appendInfoElementRelationship(\"class\", d.type);\n    }\n\n    appendInfoElementProperty(\"property\", \"id\", d.id);\n\n    Object.keys(d.properties).forEach(function (property) {\n      appendInfoElementProperty(\n        \"property\",\n        property,\n        JSON.stringify(d.properties[property])\n      );\n    });\n  }\n\n  function _types(relationships) {\n    return Array.from(new Set(relationships.map((d) => d.type)));\n  }\n\n  function _relationships(relationships) {\n    for (var i = 0; i < relationships.length; i++) {\n      if (\n        i != 0 &&\n        relationships[i].source == relationships[i - 1].source &&\n        relationships[i].target == relationships[i - 1].target\n      ) {\n        relationships[i].linknum = relationships[i - 1].linknum + 1;\n      } else {\n        relationships[i].linknum = 1;\n      }\n    }\n    return relationships;\n  }\n\n  function size() {\n    return {\n      nodes: nodes.length,\n      relationships: relationships.length,\n    };\n  }\n\n  function neo4jDataToD3Data(data) {\n    var graph = {\n      nodes: [],\n      relationships: [],\n    };\n    data?.results?.forEach(function (result) {\n      result.data.forEach(function (data) {\n        data.graph.nodes.forEach(function (node) {\n          if (!contains(graph.nodes, node.id)) {\n            graph.nodes.push(node);\n          }\n        });\n        data.graph.relationships.forEach(function (relationship) {\n          relationship.source = relationship.startNode;\n          relationship.target = relationship.endNode;\n          graph.relationships.push(relationship);\n        });\n        data.graph.relationships.sort(function (a, b) {\n          if (a.source > b.source) {\n            return 1;\n          } else if (a.source < b.source) {\n            return -1;\n          } else {\n            if (a.target > b.target) {\n              return 1;\n            }\n            if (a.target < b.target) {\n              return -1;\n            } else {\n              return 0;\n            }\n          }\n        });\n        for (var i = 0; i < data.graph.relationships.length; i++) {\n          if (\n            i !== 0 &&\n            data.graph.relationships[i].source ===\n              data.graph.relationships[i - 1].source &&\n            data.graph.relationships[i].target ===\n              data.graph.relationships[i - 1].target\n          ) {\n            data.graph.relationships[i].linknum =\n              data.graph.relationships[i - 1].linknum + 1;\n          } else {\n            data.graph.relationships[i].linknum = 1;\n          }\n        }\n      });\n    });\n    return graph;\n  }\n\n  function init(selector, _options) {\n    merge(options, _options);\n    if (options.hasOwnProperty(\"neo4jData\")) {\n      const data = neo4jDataToD3Data(options.neo4jData);\n      const container = d3.select(selector);\n      container.attr(\"class\", \"neo4jd3\").html(\"\");\n      if (options?.infoPanel) {\n        info = appendInfoPanel(container);\n      }\n      const relationships = _relationships(data.relationships);\n      const nodes = data.nodes;\n      const types = _types(relationships);\n      const svg = container\n        .append(\"svg\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .attr(\"class\", \"neo4jd3-graph\");\n      const simulation = d3\n        .forceSimulation(nodes)\n        .force(\"charge\", d3.forceManyBody().strength(options.strength))\n        .force(\n          \"link\",\n          d3\n            .forceLink(relationships)\n            .id(function (d) {\n              return d.id;\n            })\n            .distance(function (d) {\n              return options.distance;\n            })\n        )\n        .force(\n          \"center\",\n          d3.forceCenter(\n            svg.node().parentElement.parentElement.clientWidth / 2,\n            svg.node().parentElement.parentElement.clientHeight / 2\n          )\n        );\n      const svgRelationships = svg\n        .append(\"g\")\n        .attr(\"class\", \"relationships\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke-width\", 4)\n        .selectAll(\"g\")\n        .data(relationships, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"relationship\");\n      const relationshipArc = svg\n        .selectAll(\".relationship\")\n        .append(\"path\")\n        .attr(\"id\", function (d, i) {\n          return \"edgepath\" + i;\n        })\n        .join(\"path\")\n        .attr(\"stroke\", (d) => class2color(d.type));\n      const relationshipLabel = svg\n        .selectAll(\".relationship\")\n        .append(\"text\")\n        .attr(\"class\", \"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"font-size\", options.labelFontSize)\n        .attr(\"class\", \"text\")\n        .append(\"textPath\")\n        .attr(\"xlink:xlink:href\", function (d, i) {\n          return \"#edgepath\" + i;\n        })\n        .text(function (d) {\n          return `___${d.type}`;\n        });\n      const allNodes = svg\n        .append(\"g\")\n        .attr(\"class\", \"nodes\")\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"class\", \"node\")\n        .attr(\"stroke-linecap\", \"round\")\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"cursor\", \"pointer\")\n        .selectAll(\"g\")\n        .data(nodes, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"node\")\n        .on(\"mouseover\", function (e, d) {\n          if (info) updateInfo(d);\n        })\n        .on(\"mouseleave\", function (e, d) {\n          if (info) clearInfo(d);\n        })\n        .call(drag(simulation));\n      allNodes\n        .append(\"circle\")\n        .attr(\"stroke\", \"#000\")\n        .attr(\"stroke-width\", 2)\n        .attr(\"fill\", (d) => class2color(d.labels[0]))\n        .attr(\"r\", 17)\n        .append(\"title\")\n        .text(function (d) {\n          return toString(d);\n        });\n      simulation.on(\"tick\", function () {\n        relationshipArc.attr(\"d\", linkArc);\n        allNodes.attr(\"transform\", (d) => `translate(${d.x},${d.y})`);\n      });\n    }\n  }\n\n  return {\n    neo4jDataToD3Data: neo4jDataToD3Data,\n    size: size,\n    version: version,\n  };\n}\n"],"mappings":"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"}