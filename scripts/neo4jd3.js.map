{"version":3,"file":"neo4jd3.js","names":["d3","Neo4jD3","selector","_options","container","graph","info","node","nodes","relationship","relationships","simulation","svg","options","colors","schemeTableau10","neo4jData","undefined","neo4jDataUrl","distance","infoPanel","VERSION","init","version","color","length","Math","random","defaultColor","defaultEdgeColor","edgeColor","d","legend","type","nodeColor","n","labels","defaultDarkenColor","rgb","darker","merge","target","source","Object","keys","forEach","property","contains","array","id","filter","elem","linkArc","r","hypot","x","y","linknum","drag","dragstarted","event","active","alphaTarget","restart","fx","fy","dragged","dragended","on","_types","Array","from","Set","map","_relationships","i","size","appendInfoPanel","append","attr","appendInfoElement","cls","isNode","value","html","style","nodeOutlineFillColor","class2color","class2darkenColor","appendInfoElementClass","appendInfoElementProperty","appendInfoElementRelationship","updateInfo","clearInfo","properties","JSON","stringify","neo4jDataToD3Data","data","results","result","push","startNode","endNode","sort","a","b","hasOwnProperty","select","types","forceSimulation","force","forceManyBody","strength","forceLink","forceCenter","parentElement","clientWidth","clientHeight","svgRelationships","selectAll","join","relationshipArc","relationshipLabel","text","call","enter"],"sources":["../src/scripts/neo4jd3.js"],"sourcesContent":["/* global d3, document */\n/* jshint latedef:nofunc */\n\"use strict\";\n\nimport * as d3 from \"d3\";\n\nexport default function Neo4jD3(selector, _options) {\n  var container,\n    graph,\n    info,\n    node,\n    nodes,\n    relationship,\n    relationships,\n    selector,\n    simulation,\n    svg,\n    options = {\n      colors: d3.schemeTableau10,\n      neo4jData: undefined,\n      neo4jDataUrl: undefined,\n      distance: 80,\n      infoPanel: true,\n    },\n    VERSION = \"0.1.0\";\n\n  init(selector, _options);\n\n  function version() {\n    return VERSION;\n  }\n\n  function colors() {\n    // oneDark inspired by distrotube (dt)\n    return [\n      \"#1c1f24\", // black\n      \"#ff6c6b\", // red\n      \"#98be65\", // green\n      \"#da8548\", // yellow\n      \"#51afef\", // blue\n      \"#c678dd\", // magenta\n      \"#5699af\", // cyan\n      \"#a7b1b7\", // white\n      \"#5b6268\", // brighter black\n      \"#da8548\", // brighter red\n      \"#4db5bd\", // brighter green\n      \"#ecbe7b\", // brighter yellow\n      \"#3071db\", // brighter blue\n      \"#a9a1e1\", // brighter magenta\n      \"#46d9ff\", // brighter cyan\n      \"#dfdfdf\", // brighter white\n    ];\n  }\n\n  function color() {\n    return options.colors[(options.colors.length * Math.random()) << 0];\n  }\n  function defaultColor() {\n    return options.colors[4];\n  }\n  function defaultEdgeColor() {\n    return options.colors[0];\n  }\n  function edgeColor(d) {\n    return options.colors[options?.legend[d.type]];\n  }\n  function nodeColor(n) {\n    return options.colors[options?.legend[n.labels[0]]];\n  }\n  function defaultDarkenColor() {\n    return d3.rgb(options.colors[options.colors.length - 1]).darker(1);\n  }\n\n  function merge(target, source) {\n    Object.keys(source).forEach(function (property) {\n      target[property] = source[property];\n    });\n  }\n\n  function contains(array, id) {\n    var filter = array.filter(function (elem) {\n      return elem.id === id;\n    });\n    return filter.length > 0;\n  }\n\n  function linkArc(d) {\n    const r =\n      Math.hypot(d.target.x - d.source.x, d.target.y - d.source.y) / d.linknum;\n    return `\n    M${d.source.x},${d.source.y}\n    A${r},${r} 0 0,1 ${d.target.x},${d.target.y}\n  `;\n  }\n\n  function drag(simulation) {\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    return d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n  }\n\n  function _types(relationships) {\n    return Array.from(new Set(relationships.map((d) => d.type)));\n  }\n\n  function _relationships(relationships) {\n    for (var i = 0; i < relationships.length; i++) {\n      if (\n        i != 0 &&\n        relationships[i].source == relationships[i - 1].source &&\n        relationships[i].target == relationships[i - 1].target\n      ) {\n        relationships[i].linknum = relationships[i - 1].linknum + 1;\n      } else {\n        relationships[i].linknum = 1;\n      }\n    }\n    return relationships;\n  }\n\n  function size() {\n    return {\n      nodes: nodes.length,\n      relationships: relationships.length,\n    };\n  }\n\n  function appendInfoPanel(container) {\n    return container.append(\"div\").attr(\"class\", \"neo4jd3-info\");\n  }\n\n  function appendInfoElement(cls, isNode, property, value) {\n    var elem = info.append(\"a\");\n\n    elem\n      .attr(\"href\", \"#\")\n      .attr(\"class\", cls)\n      .html(\"<strong>\" + property + \"</strong>\" + (value ? \": \" + value : \"\"));\n\n    if (!value) {\n      elem\n        .style(\"background-color\", function (d) {\n          return options.nodeOutlineFillColor\n            ? options.nodeOutlineFillColor\n            : isNode\n            ? class2color(property)\n            : defaultColor();\n        })\n        .style(\"border-color\", function (d) {\n          return options.nodeOutlineFillColor\n            ? class2darkenColor(options.nodeOutlineFillColor)\n            : isNode\n            ? class2darkenColor(property)\n            : defaultDarkenColor();\n        })\n        .style(\"color\", function (d) {\n          return options.nodeOutlineFillColor\n            ? class2darkenColor(options.nodeOutlineFillColor)\n            : \"#fff\";\n        });\n    }\n  }\n\n  function class2darkenColor(cls) {\n    return d3.rgb(class2color(cls)).darker(1);\n  }\n\n  function appendInfoElementClass(cls, node) {\n    appendInfoElement(cls, true, node);\n  }\n\n  function appendInfoElementProperty(cls, property, value) {\n    appendInfoElement(cls, false, property, value);\n  }\n\n  function appendInfoElementRelationship(cls, relationship) {\n    appendInfoElement(cls, false, relationship);\n  }\n\n  function updateInfo(d) {\n    clearInfo();\n\n    if (d.labels) {\n      appendInfoElementClass(\"class\", d.labels[0]);\n    } else {\n      appendInfoElementRelationship(\"class\", d.type);\n    }\n\n    appendInfoElementProperty(\"property\", \"&lt;id&gt;\", d.id);\n\n    if (d.properties)\n      Object.keys(d.properties).forEach(function (property) {\n        appendInfoElementProperty(\n          \"property\",\n          property,\n          JSON.stringify(d.properties[property])\n        );\n      });\n  }\n\n  function clearInfo() {\n    info.html(\"\");\n  }\n\n  function neo4jDataToD3Data(data) {\n    var graph = {\n      nodes: [],\n      relationships: [],\n    };\n    data.results.forEach(function (result) {\n      result.data.forEach(function (data) {\n        data.graph.nodes.forEach(function (node) {\n          if (!contains(graph.nodes, node.id)) {\n            graph.nodes.push(node);\n          }\n        });\n        data.graph.relationships.forEach(function (relationship) {\n          relationship.source = relationship.startNode;\n          relationship.target = relationship.endNode;\n          graph.relationships.push(relationship);\n        });\n        data.graph.relationships.sort(function (a, b) {\n          if (a.source > b.source) {\n            return 1;\n          } else if (a.source < b.source) {\n            return -1;\n          } else {\n            if (a.target > b.target) {\n              return 1;\n            }\n            if (a.target < b.target) {\n              return -1;\n            } else {\n              return 0;\n            }\n          }\n        });\n        for (var i = 0; i < data.graph.relationships.length; i++) {\n          if (\n            i !== 0 &&\n            data.graph.relationships[i].source ===\n              data.graph.relationships[i - 1].source &&\n            data.graph.relationships[i].target ===\n              data.graph.relationships[i - 1].target\n          ) {\n            data.graph.relationships[i].linknum =\n              data.graph.relationships[i - 1].linknum + 1;\n          } else {\n            data.graph.relationships[i].linknum = 1;\n          }\n        }\n      });\n    });\n    return graph;\n  }\n\n  function init(selector, _options) {\n    merge(options, _options);\n    if (options.hasOwnProperty(\"neo4jData\")) {\n      const data = neo4jDataToD3Data(options.neo4jData);\n      const container = d3.select(selector);\n      container.attr(\"class\", \"neo4jd3\").html(\"\");\n      if (options.infoPanel) {\n        info = appendInfoPanel(container);\n      }\n      const relationships = _relationships(data.relationships);\n      const nodes = data.nodes;\n      const types = _types(relationships);\n      const svg = container\n        .append(\"svg\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .attr(\"class\", \"neo4jd3-graph\");\n      const simulation = d3\n        .forceSimulation(nodes)\n        .force(\"charge\", d3.forceManyBody().strength(-50))\n        .force(\n          \"link\",\n          d3\n            .forceLink(relationships)\n            .id(function (d) {\n              return d.id;\n            })\n            .distance(function (d) {\n              return options?.distance || 60;\n            })\n        )\n        .force(\n          \"center\",\n          d3.forceCenter(\n            svg.node().parentElement.parentElement.clientWidth / 2,\n            svg.node().parentElement.parentElement.clientHeight / 2\n          )\n        );\n      const svgRelationships = svg\n        .append(\"g\")\n        .attr(\"class\", \"relationships\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke-width\", 2.5)\n        .selectAll(\"g\")\n        .data(relationships, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"relationship\");\n      const relationshipArc = svg\n        .selectAll(\".relationship\")\n        .append(\"path\")\n        .attr(\"id\", function (d, i) {\n          return \"edgepath\" + i;\n        })\n        .join(\"path\")\n        .attr(\"stroke\", (d) => edgeColor(d));\n      const relationshipLabel = svg\n        .selectAll(\".relationship\")\n        .append(\"text\")\n        .attr(\"class\", \"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"font-size\", \"10px\")\n        .attr(\"class\", \"text\")\n        .append(\"textPath\")\n        .attr(\"xlink:xlink:href\", function (d, i) {\n          return \"#edgepath\" + i;\n        })\n        .text(function (d) {\n          return `___${d.type}`;\n        });\n      const node = svg\n        .append(\"g\")\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"stroke-linecap\", \"round\")\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"cursor\", \"pointer\")\n        .selectAll(\"g\")\n        .data(nodes, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .call(drag(simulation));\n      node\n        .enter()\n        .append(\"circle\")\n        .attr(\"stroke\", \"white\")\n        .attr(\"stroke-width\", 1.5)\n        .attr(\"fill\", (d) => nodeColor(d))\n        .attr(\"r\", 7)\n        .on(\"mouseenter\", function (d) {\n          if (info) {\n            updateInfo(d);\n          }\n          //if (typeof options.onNodeMouseEnter === \"function\") {\n          //  options.onNodeMouseEnter(d);\n          //}\n        })\n        .on(\"mouseleave\", function (d) {\n          if (info) {\n            clearInfo(d);\n          }\n        });\n      simulation.on(\"tick\", function () {\n        relationshipArc.attr(\"d\", linkArc);\n        node.attr(\"transform\", (d) => `translate(${d.x},${d.y})`);\n      });\n    }\n  }\n\n  return {\n    neo4jDataToD3Data: neo4jDataToD3Data,\n    size: size,\n    version: version,\n  };\n}\n"],"mappings":"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"}