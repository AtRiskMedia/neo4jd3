{"version":3,"file":"neo4jd3.js","names":["d3","Neo4jD3","selector","_options","container","graph","info","node","nodes","relationship","relationships","simulation","svg","options","colors","schemeTableau10","neo4jData","undefined","neo4jDataUrl","distance","strength","labelFontSize","VERSION","init","version","color","length","Math","random","defaultColor","defaultEdgeColor","edgeColor","d","legend","type","nodeColor","n","properties","merge","target","source","Object","keys","forEach","property","toString","s","labels","id","JSON","stringify","contains","array","filter","elem","linkArc","r","hypot","x","y","linknum","drag","dragstarted","event","active","alphaTarget","restart","fx","fy","dragged","dragended","on","_types","Array","from","Set","map","_relationships","i","size","neo4jDataToD3Data","data","results","result","push","startNode","endNode","sort","a","b","hasOwnProperty","select","attr","html","infoPanel","appendInfoPanel","types","append","forceSimulation","force","forceManyBody","forceLink","forceCenter","parentElement","clientWidth","clientHeight","svgRelationships","selectAll","join","relationshipArc","relationshipLabel","text","call"],"sources":["../src/scripts/neo4jd3.js"],"sourcesContent":["/* global d3, document */\n/* jshint latedef:nofunc */\n\"use strict\";\n\nimport * as d3 from \"d3\";\n\nexport default function Neo4jD3(selector, _options) {\n  var container,\n    graph,\n    info,\n    node,\n    nodes,\n    relationship,\n    relationships,\n    selector,\n    simulation,\n    svg,\n    options = {\n      colors: d3.schemeTableau10,\n      neo4jData: undefined,\n      neo4jDataUrl: undefined,\n      distance: 100,\n      strength: -300,\n      labelFontSize: \"12px\",\n    },\n    VERSION = \"0.1.0\";\n\n  init(selector, _options);\n\n  function version() {\n    return VERSION;\n  }\n\n  function colors() {\n    // oneDark inspired by distrotube (dt)\n    return [\n      \"#1c1f24\", // black\n      \"#ff6c6b\", // red\n      \"#98be65\", // green\n      \"#da8548\", // yellow\n      \"#51afef\", // blue\n      \"#c678dd\", // magenta\n      \"#5699af\", // cyan\n      \"#a7b1b7\", // white\n      \"#5b6268\", // brighter black\n      \"#da8548\", // brighter red\n      \"#4db5bd\", // brighter green\n      \"#ecbe7b\", // brighter yellow\n      \"#3071db\", // brighter blue\n      \"#a9a1e1\", // brighter magenta\n      \"#46d9ff\", // brighter cyan\n      \"#dfdfdf\", // brighter white\n    ];\n  }\n\n  function color() {\n    return options.colors[(options.colors.length * Math.random()) << 0];\n  }\n  function defaultColor() {\n    return options.colors[4];\n  }\n  function defaultEdgeColor() {\n    return options.colors[0];\n  }\n  function edgeColor(d) {\n    return options.colors[options?.legend[d.type]];\n  }\n  function nodeColor(n) {\n    return options.colors[options?.legend[n.properties.type]];\n  }\n\n  function merge(target, source) {\n    Object.keys(source).forEach(function (property) {\n      target[property] = source[property];\n    });\n  }\n\n  function toString(d) {\n    var s = d.labels ? d.labels[0] : d.type;\n\n    s += \" (<id>: \" + d.id;\n\n    Object.keys(d.properties).forEach(function (property) {\n      s += \", \" + property + \": \" + JSON.stringify(d.properties[property]);\n    });\n\n    s += \")\";\n\n    return s;\n  }\n\n  function contains(array, id) {\n    var filter = array.filter(function (elem) {\n      return elem.id === id;\n    });\n    return filter.length > 0;\n  }\n\n  function linkArc(d) {\n    const r =\n      Math.hypot(d.target.x - d.source.x, d.target.y - d.source.y) / d.linknum;\n    return `\n    M${d.source.x},${d.source.y}\n    A${r},${r} 0 0,1 ${d.target.x},${d.target.y}\n  `;\n  }\n\n  function drag(simulation) {\n    function dragstarted(event, d) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n    function dragged(event, d) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n    function dragended(event, d) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n    return d3\n      .drag()\n      .on(\"start\", dragstarted)\n      .on(\"drag\", dragged)\n      .on(\"end\", dragended);\n  }\n\n  function _types(relationships) {\n    return Array.from(new Set(relationships.map((d) => d.type)));\n  }\n\n  function _relationships(relationships) {\n    for (var i = 0; i < relationships.length; i++) {\n      if (\n        i != 0 &&\n        relationships[i].source == relationships[i - 1].source &&\n        relationships[i].target == relationships[i - 1].target\n      ) {\n        relationships[i].linknum = relationships[i - 1].linknum + 1;\n      } else {\n        relationships[i].linknum = 1;\n      }\n    }\n    return relationships;\n  }\n\n  function size() {\n    return {\n      nodes: nodes.length,\n      relationships: relationships.length,\n    };\n  }\n\n  function neo4jDataToD3Data(data) {\n    var graph = {\n      nodes: [],\n      relationships: [],\n    };\n    data.results.forEach(function (result) {\n      result.data.forEach(function (data) {\n        data.graph.nodes.forEach(function (node) {\n          if (!contains(graph.nodes, node.id)) {\n            graph.nodes.push(node);\n          }\n        });\n        data.graph.relationships.forEach(function (relationship) {\n          relationship.source = relationship.startNode;\n          relationship.target = relationship.endNode;\n          graph.relationships.push(relationship);\n        });\n        data.graph.relationships.sort(function (a, b) {\n          if (a.source > b.source) {\n            return 1;\n          } else if (a.source < b.source) {\n            return -1;\n          } else {\n            if (a.target > b.target) {\n              return 1;\n            }\n            if (a.target < b.target) {\n              return -1;\n            } else {\n              return 0;\n            }\n          }\n        });\n        for (var i = 0; i < data.graph.relationships.length; i++) {\n          if (\n            i !== 0 &&\n            data.graph.relationships[i].source ===\n              data.graph.relationships[i - 1].source &&\n            data.graph.relationships[i].target ===\n              data.graph.relationships[i - 1].target\n          ) {\n            data.graph.relationships[i].linknum =\n              data.graph.relationships[i - 1].linknum + 1;\n          } else {\n            data.graph.relationships[i].linknum = 1;\n          }\n        }\n      });\n    });\n    return graph;\n  }\n\n  function init(selector, _options) {\n    merge(options, _options);\n    if (options.hasOwnProperty(\"neo4jData\")) {\n      const data = neo4jDataToD3Data(options.neo4jData);\n      const container = d3.select(selector);\n      container.attr(\"class\", \"neo4jd3\").html(\"\");\n      if (options.infoPanel) {\n        info = appendInfoPanel(container);\n      }\n      const relationships = _relationships(data.relationships);\n      const nodes = data.nodes;\n      const types = _types(relationships);\n      const svg = container\n        .append(\"svg\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .attr(\"class\", \"neo4jd3-graph\");\n      const simulation = d3\n        .forceSimulation(nodes)\n        .force(\"charge\", d3.forceManyBody().strength(options.strength))\n        .force(\n          \"link\",\n          d3\n            .forceLink(relationships)\n            .id(function (d) {\n              return d.id;\n            })\n            .distance(function (d) {\n              return options.distance;\n            })\n        )\n        .force(\n          \"center\",\n          d3.forceCenter(\n            svg.node().parentElement.parentElement.clientWidth / 2,\n            svg.node().parentElement.parentElement.clientHeight / 2\n          )\n        );\n      const svgRelationships = svg\n        .append(\"g\")\n        .attr(\"class\", \"relationships\")\n        .attr(\"fill\", \"none\")\n        .attr(\"stroke-width\", 2.5)\n        .selectAll(\"g\")\n        .data(relationships, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .attr(\"class\", \"relationship\");\n      const relationshipArc = svg\n        .selectAll(\".relationship\")\n        .append(\"path\")\n        .attr(\"id\", function (d, i) {\n          return \"edgepath\" + i;\n        })\n        .join(\"path\")\n        .attr(\"stroke\", (d) => edgeColor(d));\n      const relationshipLabel = svg\n        .selectAll(\".relationship\")\n        .append(\"text\")\n        .attr(\"class\", \"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"font-size\", options.labelFontSize)\n        .attr(\"class\", \"text\")\n        .append(\"textPath\")\n        .attr(\"xlink:xlink:href\", function (d, i) {\n          return \"#edgepath\" + i;\n        })\n        .text(function (d) {\n          return `___${d.type}`;\n        });\n      const node = svg\n        .append(\"g\")\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"class\", \"node\")\n        .attr(\"stroke-linecap\", \"round\")\n        .attr(\"stroke-linejoin\", \"round\")\n        .attr(\"cursor\", \"pointer\")\n        .selectAll(\"g\")\n        .data(nodes, function (d) {\n          return d.id;\n        })\n        .join(\"g\")\n        .call(drag(simulation));\n      node\n        .append(\"circle\")\n        .attr(\"stroke\", \"white\")\n        .attr(\"stroke-width\", 1.5)\n        .attr(\"fill\", (d) => nodeColor(d))\n        .attr(\"r\", 17)\n        .append(\"title\")\n        .text(function (d) {\n          return toString(d);\n        });\n      simulation.on(\"tick\", function () {\n        relationshipArc.attr(\"d\", linkArc);\n        node.attr(\"transform\", (d) => `translate(${d.x},${d.y})`);\n      });\n    }\n  }\n\n  return {\n    neo4jDataToD3Data: neo4jDataToD3Data,\n    size: size,\n    version: version,\n  };\n}\n"],"mappings":"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"}